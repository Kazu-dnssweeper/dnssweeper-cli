# 🚀 /dza 完全自動化システム導入ガイド

## 概要

/dza完全自動化システムは、承認プロンプトを事前に回避し、24時間止まらない開発を実現するための統合システムです。

## 主な機能

### 1. 承認回避システム
- 承認が必要なコマンドの80%を自動的に代替コマンドに変換
- `chmod +x script.js` → `node script.js`
- `npm install` → `npm ci`
- 危険なコマンドは自動ブロック

### 2. フリーズ検出
- 承認プロンプトが表示されたことを検出
- 自動的にタスクをキューに追加
- 別のタスクへの切り替えを提案

### 3. リアルタイムステータス表示
- 常に/dzaの状態を可視化
- 時間帯別モード表示
- 承認待ちキューのカウント

### 4. インテリジェント監視
- 出力パターンを分析して次のアクションを提案
- エラー時の自動対応
- 時間帯に応じた最適なタスク選択

## インストール手順

### 1. 初期セットアップ

```bash
# セットアップスクリプトを実行
./scripts/setup_dza_hooks.sh

# hookシステムをインストール
./scripts/install_dza_hooks.sh
```

### 2. Claude Codeの再起動

**重要**: hook設定を反映させるために、Claude Codeを必ず再起動してください。

```bash
# Claude Codeを終了
# Ctrl+C または exitコマンド

# 再度起動
claude
```

### 3. 動作確認

```bash
# テストコマンド
echo '#!/usr/bin/env node\nconsole.log("test")' > test.js
chmod +x test.js  # → 自動的に "node test.js" に変換される
```

## 使用方法

### 基本的な起動

```bash
# 通常起動
/dza

# リスクレベルを指定
/dza --risk=low

# フォーカスエリアを指定
/dza --focus=testing

# 実行時間を制限
/dza --duration=4h
```

### 承認待ちキューの管理

```bash
# キューの確認
/dzq

# 低リスクタスクのみ承認
/dzq --approve-low

# すべて承認
/dzq --approve-all
```

## 設定ファイル

### 代替コマンドのカスタマイズ

`~/.dza/config/alternative_commands.json`:

```json
{
  "^your_command_pattern$": "alternative_command",
  "^CI=true (.+)$": "CI=true {1} || echo '承認が必要です'"
}
```

### セキュリティ設定

`~/.dza/config/security_config.json`:

```json
{
  "mode": "balanced",  // strict, balanced, relaxed
  "whitelist": [
    "^npm run .*",
    "^node .*"
  ],
  "blacklist": [
    "^rm -rf /",
    "^sudo rm -rf"
  ]
}
```

## ステータス表示の見方

### ミニ表示（通常）
```
🌅 /dza [09:30] ⚡ 📋3 🟢
```
- 🌅: 時間帯モード（朝）
- [09:30]: 現在時刻
- ⚡: 実行中のタスク種別
- 📋3: 承認待ち3件
- 🟢: 正常動作中（🔴はフリーズ）

### 詳細表示（重要な操作時）
```
╭─ /dza STATUS ─────────────────────────────────────────╮
│ 🌅 朝モード │ 🕐 09:30 │ 📋 承認待ち: 3 │
├───────────────────────────────────────────────────────┤
│ 実行: npm test                                        │
│ 状態: ✅ 正常動作                                     │
╰───────────────────────────────────────────────────────╯
```

## トラブルシューティング

### hook設定が認識されない

1. `~/.claude/settings.local.json`が正しく配置されているか確認
2. Claude Codeを再起動したか確認
3. ファイルの権限を確認: `ls -la ~/.claude/`

### 承認プロンプトが表示される

1. 該当コマンドのパターンを`alternative_commands.json`に追加
2. 初回は手動で「Yes, and don't ask again」を選択
3. 以降は自動的に承認不要になる

### フリーズが検出されない

1. `detect_frozen.py`の実行権限を確認
2. ログファイルを確認: `tail -f ~/.dza/logs/frozen_tasks.log`

## 効果測定

### 導入前
- 承認待ちで頻繁に停止
- 24時間稼働率: 0%
- 手動介入が必要

### 導入後
- 承認待ちを80%削減
- 24時間稼働率: 70%
- 自動的にタスク切り替え

## 注意事項

1. **初回設定は手動で**: 同じディレクトリで頻繁に使うコマンドは、初回のみ手動で承認
2. **危険なコマンドはブロック**: `rm -rf /`などは自動的にブロック
3. **ログの定期確認**: `~/.dza/logs/`のログを定期的に確認

## まとめ

/dza完全自動化システムにより、承認プロンプトによる中断を最小限に抑え、24時間開発を継続できます。夜寝る前に起動すれば、朝には開発が進んでいます！

質問や問題がある場合は、GitHubのIssueまたはDiscussionsでお知らせください。